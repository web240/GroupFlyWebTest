
@using GroupflyGroup.Platform.ObjectFramework
@using GroupflyGroup.Platform.ObjectFramework.Persistence
@using GroupflyGroup.Platform.ObjectFramework.Strings
@model GroupflyGroup.Platform.Web.Models.ErrorViewModel
<style>
    .fpp-error-title {
        position: relative;
        padding: 10px;
        font-weight: bold;
        -webkit-border-top-left-radius: 4px;
        -webkit-border-top-right-radius: 4px;
    }

    .fpp-error-stacktrace {
        border-top: none;
        -webkit-border-bottom-left-radius: 4px;
        -webkit-border-bottom-right-radius: 4px;
        padding: 10px;
        line-height: 20px;
        font-size: 12px;
    }

    .fpp-error-title-full-radius {
        -webkit-border-bottom-left-radius: 4px;
        -webkit-border-bottom-right-radius: 4px;
        
    }

    .fpp-display-none {
        display: none;
    }

    #errorRefresh {
        left: 2px;
        top: 8px;
    }

    .fpp-error-toggle-collapse {
        cursor: pointer;
        right: 8px;
        top: 8px;
    }

    .fpp-icon {
        font-size: 12px;
        color: darkgray;
    }

    .error-container {
        margin: 5px;
        max-height: 450px;
    }
    
    .error-icon {
        font-size: 20px;
        color: darkred;
    }

    #errorMessage {
        font-size: 14px;
        color: #333;
    }
</style>

<div class="error-container">
    <div class="fpp-error-title">
        <span class="fa fa-times-circle error-icon" title=""></span>
        <span id="errorMessage">
            @Html.Raw(Model.ErrorMessage?.Replace("\r\n", "<br/>"))
        </span>
        @if(Model.CanRead)
        {
            <span class="fpp-error-toggle-collapse fpp-icon" style="float: right;">查看详情</span>
        }
    </div>
    <div id="errorDetail" class="fpp-error-stacktrace">
        @if (Model.CanRead)
        {
            @Html.Raw(Model.ErrorDetail?.Replace("\r\n", "<br/>"))
        }
    </div>
</div>




<script type="text/javascript">
    var isIframe = top.location !== self.location;
    var isCollapsed = false;
    if (isIframe) {
        $('.fpp-error-title').addClass('fpp-error-title-full-radius');
        $('.fpp-error-stacktrace').addClass('fpp-display-none');
        $('.fpp-error-toggle-collapse').addClass('fpp-arrow-down');
        isCollapsed = true;
    }
    else {
        $('.fpp-error-toggle-collapse').addClass('fpp-arrow-up');
    }
    var dialog = $(ComponentRoot.get("errorDiv"));
    
    function toggle() {
        var height = 0;
        if (isCollapsed) {
            $('.fpp-error-toggle-collapse').text('收起详情');
            $('.fpp-error-title').removeClass('fpp-error-title-full-radius');
            $('.fpp-error-stacktrace').removeClass('fpp-display-none');
            isCollapsed = false;
            height = 500;
        }
        else {
            $('.fpp-error-toggle-collapse').text('查看详情');
            $('.fpp-error-title').addClass('fpp-error-title-full-radius');
            $('.fpp-error-stacktrace').addClass('fpp-display-none');
            isCollapsed = true;
            height = 110;
        }
        dialog.dialog('resize', {
            width: 800,
            height: height
        });
    }
    $('.fpp-error-toggle-collapse').click(toggle);
    toggle();
    dialog.dialog("open");
</script>